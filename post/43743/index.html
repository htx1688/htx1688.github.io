<!DOCTYPE html>
<html
  lang="zh-cn"
  itemscope
  itemtype="http://schema.org/WebPage"
>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
          闪电网络：历史与现实 - 区块大全
        </title>
    

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="佚名" /><meta name="description" content="Aaron Van Wirdum的《闪电网络的历史：从头脑风暴，到测试版本》记录了2018年前闪电网络的有趣历史。" />
<meta name="keywords" content="Lightning" />







<meta name="generator" content="Hugo 0.120.4" />


<link rel="canonical" href="/post/43743/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.d8d87b982993a745e5e7b6a6cbf257be8c3e82aab5e485f0908ad7e6c3501ab2.css" integrity="sha256-2Nh7mCmTp0Xl57amy/JXvow&#43;gqq15IXwkIrX5sNQGrI=" media="screen" crossorigin="anonymous">







<meta property="og:title" content="闪电网络：历史与现实" />
<meta property="og:description" content="Aaron Van Wirdum的《闪电网络的历史：从头脑风暴，到测试版本》记录了2018年前闪电网络的有趣历史。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/43743/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-10-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-10-21T00:00:00+00:00" />

<meta itemprop="name" content="闪电网络：历史与现实">
<meta itemprop="description" content="Aaron Van Wirdum的《闪电网络的历史：从头脑风暴，到测试版本》记录了2018年前闪电网络的有趣历史。"><meta itemprop="datePublished" content="2022-10-21T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-10-21T00:00:00+00:00" />
<meta itemprop="wordCount" content="9303">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="闪电网络：历史与现实"/>
<meta name="twitter:description" content="Aaron Van Wirdum的《闪电网络的历史：从头脑风暴，到测试版本》记录了2018年前闪电网络的有趣历史。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




  </head>
  <body>
    <div id="back-to-top"></div>

    <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">区块大全</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="/categories/">分类</a>
          
        
      </li>
    

    
  </ul>
</nav>


    
      






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

    

    

    


    <header id="header" class="header">
      <div class="logo-wrapper">
  <a href="/" class="logo">
    
      区块大全
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="/categories/">分类</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

    </header>

    <div id="mobile-panel">
      <main id="main" class="main bg-llight wallpaper">
        <div class="content-wrapper">
    <div id="content" class="content">
      <article class="post">
        
        <header class="post-header">
          <h1 class="post-title">闪电网络：历史与现实</h1>
          

          <div class="post-meta">
  <div class="post-meta-author">
    by
      佚名
    
  </div>

  <div class="post-meta-time">
    <time datetime="2022-10-21">
      2022-10-21
    </time>
  </div>

  


  <div class="post-meta__right">
    <span class="post-meta-more">
        约 9303 字 -
        预计阅读 19 分钟
      </span>

    <div class="post-meta-category">
        <a href="/categories/%E5%85%B6%E5%AE%83%E6%96%87%E7%AB%A0/"> 其它文章 </a>
          
      </div>


    
    


    
    
  </div>
</div>

        </header>

        
        <div class="post-content">
          <table>
    <thead>
        <tr>
            <th style="text-align:left">推荐平台</th>
            <th style="text-align:left">链接</th>
            <th style="text-align:left">平台介绍</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">币安网</span></td>
            <td style="text-align:left"><span style="white-space:nowrap"><a
                        href="https://www.okbtc.cn/binance?ref=githubio">注册链接</a></span></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/binance?ref=githubio">币安是全球领先的区块链生态系统，推出了一系列产品，其中包括最大的加密货币交易平台。我们的使命是在未来成为全球性加密货币基础架构供应商。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">欧易OKX</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/okx?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/okx?ref=githubio">欧易是全球著名的数字资产交易平台之一，主要面向全球用户提供比特币、莱特币、以太币等数字资产的币币和衍生品交易服务。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">HTX火币</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/htx?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/htx?ref=githubio">火币全球专业站，是火币集团旗下服务于全球专业交易用户的创新数字资产国际站，致力于发现优质的创新数字资产投资机会。</a>
            </td>
        </tr>
    </tbody>
</table>
<p><strong>初心</strong></p>
<p>Aaron Van Wirdum的《<strong>闪电网络的历史：从头脑风暴，到测试版本</strong> 》记录了2018年前闪电网络的有趣历史。</p>
<p>中本聪在2009年创造BTC的时候就有关于支付通道的想法，并且在Bitcoin 1.0里就已经包含了支付通道的最初代码实现，之后的几年，支付通道乃至闪电网络的想法一直在被BTC社区讨论。</p>
<p>Vitalik早年创办的bitcoinmagazine收录了闪电网络的许多重要文章，2013年底，Vitalik在考虑如何进一步扩展比特币和Mastercoin功能的时候，向Mastercoin团队提出了一个更通用的方案，该方案允许用灵活且可编写脚本（但不是图灵完备的）的合约取代Mastercoin的专业合约语言。虽然Mastercoin团队对此印象深刻，但这一提议太过激进，无法适应他们的发展路线图，建议被拒绝。</p>
<p>于是，被拒绝的Vitalik开始起草以太坊白皮书，以实现其关于链上智能合约的想法，而BTC的开发者们也逐渐形成共识 - 放弃在一层实现智能合约和扩容的路线，把一层的功能固定在安全性和基本功能上面，而把各种扩展放到链下实现，两条公链背后是两种理念。</p>
<p><strong>成型</strong></p>
<p>2015年2月是一个比较重要的时间节点，经历了程序员们的大量讨论之后，Thaddeus Dryja 和 Joseph Poon 一起撰写了一份名为 “The Bitcoin Lightning Network: Scalable Off-Chain Instant Payments ” 的白皮书，在 2015 年的 2 月首次发布，并且在旧金山比特币开发者研讨会（Bitcoin Devs Seminar）上首次展示了他们的构想。</p>
<p>在这之后的几个月，整个 2015 年的春天和夏天，比特币的扩展问题和区块大小上限的分歧演变成了公开的争执。在这种危机气氛中，人们在 2015 年底召开了连续两场大会：9 月份召开了 Scaling Bitcoin Montreal，10 月份是 Scaling Bitcoin Hong Kong。在蒙特利尔，Poon 和 Dryja 再次登台演讲，并且都在香港作了第二次更深入的演讲。</p>
<p>就在香港的大会之后，Gregory Maxwell 在比特币开发者邮件组中提出了一份扩展方案路线图。这张路线图突出地包括了闪电网络。它获得了比特币技术社区大部分人的支持，并且变成了 Bitcoin Core 项目在事实上的路线图。</p>
<p>闪电网络的白皮书包含许多技术含量很高的概念，并不太容易读懂。</p>
<p>闪电网络的基本组件是支付通道。</p>
<p>支付通道是怎么实现的呢？这里面包含着一系列的基于BTC交易逻辑的密码学技术手段和巧思，简而言之，在资金安全得到去信任保证的前提下，两个用户同时“充值”到一个2-of-2的多签地址，然后，通过互换签名交易信息来实现每次的余额更新/完成支付，在余额的限制之内，这样的支付无需上链，交易双方依靠对正确的签名交易信息的持有就可以确保自己的利益，在需要的时候，可以通过将最新的交易信息广播上链来进行链上结算，关闭支付通道。</p>
<p>然后，通过HTLC，大量的的支付网络可以连接起来，构成网络，支付可以通过这样的网络到达与支付者并没有直接通道连接的接受者，这样一个依赖于BTC链建立的线下支付网络，被称作闪电网络。</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_npsst8kq03.png" alt="（来源：A Technical Introduction to The Lightning Network）"></p>
<p>当然，这样的描述过于简化了，要了解细节，还请读白皮书。</p>
<p><strong>建构</strong></p>
<p>目标确定之后，BTC的拥趸们满腔热情地投入了闪电网络的建设。</p>
<p>为了创建和优化闪电网络，BTC进行了多次的协议更新，其中最大的一次是隔离见证。</p>
<p>隔离见证实现的事情是，把交易中的发起方签名部分分离出来可供单独引用。</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_faw80eyjed.png" alt="An illustration of the old and new transaction serialization posted by David A. Harding."></p>
<p>这让一件事情成为可能，就是当交易A被签名好但还没有被广播的时候，基于交易A构建的子交易已经可以被广播了。这可以用于构建预先签名承诺交易，以化解将资金注入多签地址后的对手方风险，构建支付通道需要这项功能。</p>
<p>隔离见证的历史参见“The Long Road to SegWit: How Bitcoin’s Biggest Protocol Upgrade Became Reality”</p>
<p>在漫长的挣扎过后，隔离见证软分叉最终于 2017 年夏天在比特币区块链上激活，为闪电网络铺平了道路。</p>
<p>坦率讲，由支付通道自下而上构建成的闪电网络一开始就有许多问题，其中，最影响用户体验的应该是通道容量经济性问题，此外，还有支付时延问题，状态管理问题，HTLC问题，依赖于Tor的问题，详见Shinobi的《<strong>闪电网络尚不尽如人意之处</strong> 》。</p>
<p>一个通道的生命周期中需要开通和关闭两笔链上交易，但这两笔交易的成本在许多情况下也足以构成进入门槛，而且，这种类似充值卡的模式在资金使用效率上绝对谈不上高效。</p>
<p>举个例子，假设推特想利用闪电网络为3亿活跃的推特用户中的1%开通打赏功能，那么就需要为这300万用户中的每一个都开通支付通道，假设每个通道占用资金0.01BTC，那么所有这些通道将占用资金3万BTC。</p>
<p>而按1ml.com上的统计，当前（2022年10月20日）闪电网络共有82623个支付通道，通道资金5001BTC.</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_5mw2jfgspi.png" alt="来自1ml.com"></p>
<p><strong>BOLT</strong></p>
<p><em>“闪电网络的白皮书是一份长而复杂的文件，包含许多技术含量很高的概念；在 2015 年，很少有人有时间和能力读完并且理解这份文件。但 Linux 系统内核长期开发者 Rusty Russell 学习了这份白皮书后，大家的基础认识提高了一大截。在 2015 年初的</em> <em>系 列 博 客 中，Russell 为更广泛的读者 “翻译” 了这份白皮书（但还是比较挑人的）。</em></p>
<p>_然后，在2015 年 3 月，Russell 接受 Blockstream 工程的聘请，_<em>开发一个 C 语言的闪电网络实现： c-lightning。事实证明，这是迈向实现的关键一步。一个几个月前才刚刚提出的概念，现在就有了一个世界顶尖的工程师来实现它。后来，Blockstream 的 Christian Decker 也加入了 Russell；其他人（包括 Corné Plooy） 也为这个开源项目做了贡献。</em></p>
<p>_在 Russell 开始开发 c-lightning 不久之后，Blocksteam 就不是唯一一个入局实现闪电网络的公司了。在 2015 年夏天，_<em>ACINQ 这家更小的比特币科技公司（一开始计划开发基于智能卡的硬件钱包）决定也尝试一下这项富有前景的技术。这家位于巴黎的创业公司后来宣布他们开发者用 Scala 编程语言开发出了自己的闪电网络协议，叫做 eclair。</em></p>
<p>_又过了几个月，第三个实现开始起步。在 2016 年 1 月，闪电网络白皮书的作者 Poon 和 Dryja，也跟 Elizabeth Stark 和 Olaoluwa “Laolu” Osuntokun 一道，成立了一个全新的公司来开发闪电网络：_<em>Lightning Labs。Lightning Labs 带头在 lnd 上开闸，这是一个用谷歌公司推出的 Go 编程语言（也叫 “golang”）实现的闪电网络 —— 他们在公司成立之前就开始开发了。</em></p>
<p><em>在成立公司大概一年后，在 2016 年底，Dryja 离开了 Lightning Labs，转而__加入了 MIT Media Lab 的 Digital Currency Initiative，这个机构也雇用了Bitcoin Core 的顶尖开发者 Wladimir van der Laan 和多位 Bitcoin Core 的贡献者。在 MIT，Dryja 继续开发他在 Lightning Labs 起步的闪电网络实现，重命名为 lit。现在 lnd 和 lit 都可用。Lit 与 lnd 和其它实现有差异的点在于它把钱包和节点封装成了一个整体；现在，它还支持同时使用多种币。</em></p>
<p><em>此外，区块链公司</em> <em>Bitfury（因其矿池服务和挖矿硬件而知名）也 fork 了 lnd 实现、做了另一个版本。这个版本的特殊之处在于，它在设计上做了牺牲，使得无需修复比特币网络的熔融性（malleability）—— 后面我们再详细说明。Bitfury 也在交易路由领域作了贡献，最著名的成果是 “Flare” 协议（只不过现在 Bitfury 版本的 lnd 开发似乎已经停滞下来了）（译者注：“熔融性” 的例子是，本质上是同一个签名的交易，可能会产生完全不同的哈希值（交易 ID），使交易变得无法跟踪；就像同一块金属可以熔成不同的形状一样）。</em></p>
<p><em>再后来，再 2016 年，主要的钱包服务商 Blockchain 宣布他们__开发出了一个简化版的闪电网络，叫做 “thunder”。这个实现对标准的闪电网络实现做了比较大的牺牲，最明显的是它需要你信任网络中的对手方。也因为这种牺牲，它得以在 2016 年春天推出 alpha 版本，比其他开发团队要早得多。（虽然 thunder 也可能兼容闪电网络，但这一实现的开发似乎也已经停滞了。）</em></p>
<p><em>在 Scaling Bitcoin Milan 大会之后，第三次会议在 2016 年底举办，大部分闪电网络的贡献者都__齐聚一堂（这场大会因此被称为第一次闪电网络峰会）。在这里，他们讨论了如何让所有的不同实现能相互操作，从而产生了一个叫做 “BOLT”的闪电网络协议规范（BOLT 是“闪电网络技术技术（Basis of Lightning Technology）” 的缩写）。”</em></p>
<p>                                                                  -[《**闪电网络的历史：从头脑风暴，到测试版本**》](<a href="https://www.btcstudy.org/2020/09/03/history-lightning-brainstorm-beta/">https://www.btcstudy.org/2020/09/03/history-lightning-brainstorm-beta/</a>)</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_ievuz6h1or.png" alt="BOLT协议结构，源自网络"></p>
<p>闪电网络白皮书做了理论设计，BOLT是闪电网络的协议栈。是我们今天所知的、实际上的闪电网络的基础。</p>
<p><strong>OmniBOLT</strong></p>
<p>2019 年 8 月 1 日出现的OmniBOLT是BOLT协议的加强版，由omni foundation提出，顾名思义，推出这一加强版协议的最大动力是让闪电网络增加对omnilayer资产的支持。</p>
<p>github上的信息显示，OmniBOLT还支持以下功能，其中的一些还在计划阶段：</p>
<p><strong>OmniBOLT #05:</strong>  Atomic Swap Protocol among Channels</p>
<p><strong>OmniBOLT #06:</strong>  Automatic Market Maker, Liquidity Pool and DEX</p>
<p><strong>OmniBOLT #07:</strong>  Hierarchical Deterministic (HD) wallet, Invoice Encoding</p>
<p>这里所说的原子交换是通过HTLC进行的，如下图。</p>
<p>这里需要注意一点的是，在第三步，Alice用R去解锁Tx 2获取BTC时，她必然需要把R暴露给Bob，这一点是保证交换原子性的关键。</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_a3pad6vdva.png" alt="来源：https://github.com/omnilaboratory/OmniBOLT-spec/blob/master/OmniBOLT-05-Atomic-Swap-among-Channels.md"></p>
<p>当然，进行原子交换的双方不需要拥有一个直接的支付通道，只要存在连接双方的通道路由就可以，当然，如果路由长了，就会有路由费用问题，也会有交易时延问题。</p>
<p>那么可不可以有跨链的原子交换呢？当然可以，前提是交易双方拥有对应两条链的两个支付通道路由，而且这两条链的相关技术结构是一致的，如BTC和LTC。</p>
<p>事实上，在OmniBOLT还未出现的2017年11月，Ligntning Labs就进行过一次跨链的原子交换实验，详情见这里：https://blog.lightning.engineering/announcement/2017/11/16/ln-swap.html</p>
<p>对于那些持有BTC或者ominilayer资产的并且不愿在自家钱包之外交易的用户来说，这样的交易方式的出现是很有意义的。</p>
<p>OmniBOLT的AMM交易模型类似于uniswap v3。</p>
<p>这个交易模型是基于前面所述的原子交换构建的，这里不存在一个链上的智能合约，也不存在一个单个地址上的流动性池，所有的节点都可以用自己在通道里的资金提供流动性，这些通道里的资金被区分为“支付余额”和“流动性余额”。节点可以发消息给tracker，告知自己提供的流动性是多少，愿意参与做市的价格区间是多少。</p>
<p>tracker是一个交易撮合引擎，不断收集流动性信息和交易请求信息，可以匹配的时候，就帮助节点间撮合，达成交易。</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_3i96u1qos5.png" alt="来源：https://github.com/omnilaboratory/OmniBOLT-spec/blob/master/OmniBOLT-06-Automatic-Market-Maker-and-DEX.md"></p>
<p>节点并不需要信任tracker，节点可以去验证tracker提供的信息真伪以及是否符合自己的交易条件，然后决定是否确认交易。</p>
<p>这里节点参与做市有没有无常损失呢？跟uniswap v3一样，有，但LP可以通过设置做市价格区间将无常损失控制在较低的水平。</p>
<p>简而言之，这里的交易逻辑相当于uniswap v3 + 订单薄，只是是在一个分布式的流动性池上，基于原子交换的逻辑来实现的。</p>
<p>以上的种种技术手段，也可以用来实现抵押借贷，但到目前为止，github上面的信息显示，OmniBOLT的关于抵押借贷的设想还处在社区讨论可行性的阶段，并未列入开发路线图。</p>
<p><strong>Taproot</strong></p>
<p>2021年11月中，BTC完成了Taproot升级，这可以说是在隔离见证之后BTC最重要的一次升级，</p>
<p>Taproot 升级则是三个 BIPs 的汇编，这三个 BIPs 分别是 Schnorr 签名(BIP 340)、Taproot (BIP 341)和TapScript (BIP 342)，这三个升级统称为 BIP Taproot，它为比特币带来了更高效、更灵活、更私密的传输方式，其核心在于使用了 Schnorr 签名和 Merkel 抽象语法树(MAST)。</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_57psf59jr0.png" alt="来源：https://newbtcworld.medium.com/huffman-taproot-optimization-85698babf742"></p>
<p>Taproot的原理，简单来说，就是定义了一种输出和两种花费路径。如上图所示，有Alice和Bob两个参与者，Taproot的运作过程如下:</p>
<p>将Alice和Bob的公钥聚合为：C=P_A+P_B</p>
<p>加入MerkleRoot，公钥聚合为：P=C+H(C||MerkleRoot)G，其中 H(C||MerkleRoot) 表示C和MerkleRoot的组合hash</p>
<p>锁定脚本中填入聚合公钥P，格式类似Segwit：[ver] [P]。ver表示版本号，Taproot中ver=1。</p>
<p>花费路径有两个，二选一：</p>
<p>签名模式：Alice和Bob全部签名产生聚合签名，填入见证脚本。利用聚合公钥P,对签名进行验证后即可花费。</p>
<p>脚本模式：Alice和Bob，有一个拒绝签名，可以走脚本模式。此时Alice想要完成花费，那么见证脚本中需要填入：符合Script 1的执行数据D, Script 1, C, Hash 2 。为了验证签名，首先利用Script 1, Hash2，计算MerkleRoot，然后验证 P==C+H(C||MerkleRoot)G 是否成立，最后构建完整脚本D||Script 1并执行脚本，验证结果是否为真。当上述验证通过后，即可完成花费。</p>
<p>Taproot按照签名模式进行花费时，多个参与方和单个参与方在区块链上看起来都长得是一样的，所以许多区块链分析将不可用，从而为所有 Taproot 用户保留隐私。与此同时，Taproot的脚本花费模式让用户可以实现复杂的支出条件。Taproot可以有效压缩交易脚本字节数。签名模式下随着参与者增加，EDSA交易脚本大小线性增长，Taproot交易脚本大小保持不变。脚本模式下随着脚本数量的增加，EDSA交易脚本大小线性增长，Taproot交易脚本大小对数增长。</p>
<p>Taproot让智能合约成为可能了吗？</p>
<p>Taproot的确让一些基于复杂条件的交易成为可能，Schnorr 签名也的确让大批量签名变得可行，但Taproot也并没有增强多少BTC的可编程性，它对BTC进行的“智能”加持依然是很有限的。</p>
<p>Taproot催生的最亮眼的孩子是Lighting Labs的Taro。</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_tlg5i2ws8v.png" alt="来源：https://mirror.xyz/huzhiwei.eth/J2Kv1ATWo0_d3ZidG-8BDrIJcYX7DFew_ruQ2p03sgU"></p>
<p>与Omnilayer和RGB一样，Taro在BTC链上发行资产的方式也是把资产交易元数据放到UTXO输出里面，不过Taro使用了新增的Taproot交易类型来实现这一切，因此应该更加地高效，隐私保护也更好。</p>
<p><strong>RGB</strong></p>
<p>比特币链下协议领域的研究和发展为比特币打开了一扇窗户，开发者们追求的已经远不止以去中心化的方式转移价值。他们开始尝试走得更远，比如说，用链下协议的方式实现智能合约， RGB 是这类项目中的佼佼者。</p>
<p>RGB 基于 Peter Todd 关于一次性密封和客户端验证的研究，并被 Giacomo Zucco 和社区在 2016 年设想为比特币和闪电网络上更好的资产发行协议。这些想法的进一步发展导致 Maxim Orlovsky 将 RGB 开发成一个更加全面的智能合约系统，他自 2019 年以来在社区的参与下领导了这个系统的实现。</p>
<p>根据官方描述，RGB 定义为一组允许我们以可扩展和保密的方式执行复杂智能合约的开源协议。它并非一个特定的网络（如比特币或闪电网络）；每个智能合约只是一组能用不同通信通道（默认为闪电网络）进行交互的合约参与者。RGB 利用比特币区块链作为其状态承诺层，并在链下维护智能合约的代码和数据，借此实现可扩展性。它利用比特币交易（以及脚本）作为智能合约的所有权控制系统；尽管智能合约的演化是通过一套链下方案来定义的。最后需要注意的是，所有内容都是在客户端验证的。</p>
<p>简而言之，RGB 是一个允许用户随时审计、执行和验证智能合约的系统，而无需任何额外的开销，它并没有按照 “传统” 的方式来使用区块链。</p>
<p>一些RGB的拥趸们看不上以太坊，下面这张出自他们之手的表很能表现他们的这种态度。</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_7pzwhnbvt8.png" alt="来源：https://bitcoinmagazine.com/guides/a-brief-introduction-to-rgb-protocols"></p>
<p>这里需要简单讨论一下比特币的可编程性以及对比一下比特币与以太坊的智能合约的不同。</p>
<p>比特币的运行基于两个基本的概念：交易和 UTXO。当一笔交易创造了一个新的UTXO的时候，会自带一个由锁定脚本表达的解锁条件，当下一个交易要话费这个UTXO的时候，必须提供相应数据，通过锁定脚本所指定的验证程序，否则就无法花费。若要编程比特币，不外乎要在交易层面或者脚本层面做文章。</p>
<p>比特币的编程工具箱，目前有签名，多重签名，哈希锁，时间锁，流程控制等工具。</p>
<p>对比一下以太坊和比特币，可以发现比特币的可编程性在下面这些方面有明显的限制：</p>
<ol>
<li>
<p>它允许的验证程序不是任意的，只有有限的几种。</p>
</li>
<li>
<p>它不允许将资金的内部状态存储在脚本中。即使它规定了多条解锁路径，也无法限制各解锁路径能够动用的资金量，只要能解锁资金，运用任何一条路径都可以使用全部资金。也可以说，脚本是不会计算的。</p>
</li>
<li>
<p>它不允许限制资金的花费方式。在一个 UTXO 解锁之后，怎么花都可以，脚本完全无法限制资金的花费方式。</p>
</li>
<li>
<p>解锁脚本所表达的是完备、独立的解锁条件，它不允许我们表达对另一个 UTXO 的依赖。一个 UTXO 不会（也不能）根据另一个 UTXO 存不存在来决定自己能不能解锁，也不会（不能）根据另一个 UTXO 的锁定条件来决定自己能不能解锁。一言以蔽之，在花费一个 UTXO 时，该 UTXO 的锁定脚本和交易所提供的解锁脚本就是一个独立的宇宙，不受任何外在的东西干扰。</p>
</li>
</ol>
<p>如果我们问一位热爱BTC的技术专家，BTC支持智能合约吗？他很可能会说，BTC从一开始就是支持智能合约的。</p>
<p>我们没法说他错，因为简单的脚本程序也可以说是智能合约，闪电网络可以说是基于BTC区块链运行的合约式协议，我们仔细研究闪电网络时，会发现一些特点，可能是BTC原生智能合约的共同特点：</p>
<ul>
<li>
<p>可以使用交易来表达合约的状态，交易的更替就表示合约状态的变化。</p>
</li>
<li>
<p>如果进入一种状态会面临失控的风险，可以通过预先签名承诺交易，来约束进入这种状态之后的走向，从而消除相应的对手方风险。比如，进入一个 2-of-2 多签名输出有可能导致资金被锁定，那就先安排一笔花费这个输出的交易。</p>
</li>
<li>
<p>除了退出合约以外，状态的更新总是需要所有参与方在线。</p>
</li>
<li>
<p>表达状态的历史交易需要参与方各自存储（至少在目前是如此）。</p>
</li>
<li>
<p>锁定脚本的主要作用是安排合约参与者的行动优先权，而不是直接产生结果；换言之，基于比特币的协议编程是在运用博弈学。</p>
</li>
</ul>
<p>比特币的编程对应用开发人员和应用参与者都提出了更高的要求，这些限制使得应用开发起来更不直观、更难分析，打个不恰当的比方，有点像螺丝壳里做道场，或者用汇编语言写操作系统。用户也不能依靠区块链来为他们提供充足的便利，而必须自己承担更多的责任（比如在闪电网络中，你需要自己保管历史状态交易和相应的哈希原像，或者至少要有人负责保管）。</p>
<p>我们不能说BTC如此限制可编程性没有意义，比特币一直在事实上奉行着一种“资源使用最小化”原则，拒绝低成本交易占用区块空间，扩展？到链下去。现在的这种状态是坚持初心的自然结果。</p>
<p>在以太坊的语境里，“智能合约”意味着在虚拟机环境中确定性的运行的不可变的计算机程序，合约部署在链上的合约账户中，EVM在每个以太坊节点上作为本地实例运行，但由于EVM的所有实例都在相同的初始状态下运行并产生相同的最终状态，因此整个系统表现为单台图灵完备的世界计算机。</p>
<p>交易的原子性由EVM运行的规则保证，无论合约在被调用时执行的是什么。仅在交易成功终止时记录全局状态（合约，帐户等）的任何更改。成功终止意味着程序执行时没有错误并且达到执行结束。如果交易由于错误而失败，则其所有效果（状态变化）都会“回滚”，就好像交易从未运行一样。失败的交易仍存储在区块链中，并从原始账户扣除gas成本，但对合约或账户状态没有其他影响。</p>
<p>这里，智能合约上链，所有状态上链，带来的结果是良好的开发者和用户体验，当然，还有区块链的膨胀。</p>
<p>我们无法简单评判哪条道路的对错，这是选择的问题。</p>
<p>当然，RGB团队是BTC道路的深度信仰者，他们如此解释他们的选择：</p>
<p><em>当前的区块链行业提倡把智能合约代码和数据都存储在区块链上，并由全网所有节点执行，而无视区块链体积的过度增长和计算资源的滥用。由 RGB 提出的方案则更加智能和高效，因为它通过将智能合约和数据从区块链中分离出来而摆脱了区块链范式，从而避免了在其它平台上常见的网络饱和的情况，反过来，它并不要求每个节点都执行每份合约，而是将执行者变成了合约的相关方，这带来了前所未见的保密性。</em></p>
<p><em>RGB 上的智能合约开发者定义了一套方案来规定合约如何随时间推移而演化。这套方案是在 RGB 中构建智能合约的标准，发行者在定义发行的合约时和钱包或交易所在面对具体的合约时，必须先以这套标准来验证合约。只有当验证无误时，每个参与方才能接受请求并处理相应的资产。</em></p>
<p><em>RGB 中的智能合约是一个由状态变更构成的有向无环图（DAG），该图始终只有一部分是已知的，其余部分则无法访问。RGB 方案是规定智能合约如何演化的一组核心规则，是所有智能合约的起点。每个合约参与方都可以对这组规则进行补充（在架构允许的前提下），由此产生的图是根据这些规则的迭代式应用而构建的。</em></p>
<p>                                      - Francisco Calderon[《A brief Introduction to RGB Protocols》](<a href="https://bitcoinmagazine.com/guides/a-brief-introduction-to-rgb-protocols">https://bitcoinmagazine.com/guides/a-brief-introduction-to-rgb-protocols</a>)</p>
<p>听起来很美好，但既然把比特币区块链当成状态承诺层，就必然受制于BTC可编程性的局限，在许多场景之下，这些局限都是相当关键的。</p>
<p>RGB的开发目前也基本上只是走到了发行资产这一步，链下智能合约的实现绝不会顺利，是否真正有机会匹敌乃至超越链上智能合约更要打上一个大大的问号。</p>
<p><strong>前景</strong></p>
<p>几个月来，闪电网络领域大额融资频出，尤其被关注的是以下几个：</p>
<p>加密支付应用提供商Strike 融资 8000 万美元。 ❕</p>
<p>Lightning Labs 获得 7000 万美元融资。</p>
<p>lightspark从a16z和paradigm获得投资，投资额未披露。</p>
<p>闪电网络的通道容量近两年有了较大的增长：</p>
<p>背后主要是这些机构的力量：</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_oikggwvjr5.png" alt="来源：https://river.com/learn/files/river-lightning-report.pdf"></p>
<p>虽然增长较快，但目前闪电网络的整体容量与粉丝们对它的期望相比还是很不相符的。下面是1ml10月20日的数据。</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_b6s064maqd.png" alt="来源：1ml.com"></p>
<p>毕竟跨链到ETH的BTC有17万以上。</p>
<p>基于闪电网络的衍生品交易平台Kollider， 10月22日日交易量约1.1BTC。</p>
<p><img src="https://img.bibiqing.com/news/2022/1021/27_1o0vsehmgc.png" alt="https://pro.kollider.xyz/"></p>
<p>毕竟闪电网络更适合于微支付，并不太适合于大额交易。</p>
<p>闪电网络对于BTC代表的链下扩容路线有着里程碑的意义，虽然一路艰辛，但在开发者努力，大额融资与社区热望加持之下，闪电网络应该是能掀起一波应用热潮的。</p>
<p>毕竟气氛已经烘托到这里了。</p>
<p>但鉴于其局限，也不应该对其抱有不切实际的期望。</p>
<table>
    <thead>
        <tr>
            <th style="text-align:left">推荐平台</th>
            <th style="text-align:left">链接</th>
            <th style="text-align:left">平台介绍</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">Gate芝麻开门</span></td>
            <td style="text-align:left"><span style="white-space:nowrap"><a
                        href="https://www.okbtc.cn/gateio?ref=githubio">平台介绍</a></span></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/gateio?ref=githubio">Gate.io芝麻开门创立于2013年，是全球真实交易量TOP10的加密货币交易平台，向全球数千万用户提供安全可靠、真实透明的数字资产交易服务。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">Bitget</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/bitget?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/bitget?ref=githubio">Bitget的背后是一群区块链技术的早期接受者，也是区块链未来发展的信仰者，一直致力于提供安全、一站式的交易解决方案，帮助用户更聪明地交易。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">Bybit</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/bybit?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/bybit?ref=githubio">Bybit通过数字资产与传统金融的结合，引领数字资产的生态发展。提供一流的流动性，致力于打造业内最安全、公平、高效及人性化的交易服务平台。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">派网</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/pionex?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/pionex?ref=githubio">派网提供多样化的量化交易机器人，用户可依照自身交易需求和策略选择最适合的机器人。 同时派网也提供合约交易与合约网格机器人，给予更方便的合约交易体验。</a>
            </td>
        </tr>
    </tbody>
</table>

        </div>

        
        



        
        


        <footer class="post-footer">
          


          
          <nav class="post-nav">
            
              <a class="prev" href="/post/43721/">
                
                <i class="iconfont">
                  <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

                </i>
                <span class="prev-text nav-default">全方位解读Web3域名：DID基石、NFT新增长点</span>
                <span class="prev-text nav-mobile">上一篇</span>
              </a>
            
              <a class="next" href="/post/43736/">
                <span class="next-text nav-default">速览Arbitrum首届波哥大黑客松获奖项目</span>
                <span class="prev-text nav-mobile">下一篇</span>
                
                <i class="iconfont">
                  <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

                </i>
              </a>
          </nav>
        </footer>
      </article>

      
      
        
      


      
      


    </div>

    
    


  </div>

      </main>

      <footer id="footer" class="footer">
        <div class="icon-links">
  

<a href="https://www.okbtc.cn/binance?ref=githubio" class="iconfont">
  <img src="/image/logo/binance.png" width="36px" height="36px" alt="binance">
</a>

<a href="https://www.okbtc.cn/okx?ref=githubio" class="iconfont">
  <img src="/image/logo/okx.png" width="36px" height="36px" alt="okx">
</a>

<a href="https://www.okbtc.cn/htx?ref=githubio" class="iconfont">
  <img src="/image/logo/htx.png" width="36px" height="36px" alt="htx">
</a>

<a href="https://www.okbtc.cn/gateio?ref=githubio" class="iconfont">
  <img src="/image/logo/gateio.png" width="36px" height="36px" alt="gateio">
</a>

<a href="https://www.okbtc.cn/bitget?ref=githubio" class="iconfont">
  <img src="/image/logo/bitget.png" width="36px" height="36px" alt="bitget">
</a>

<a href="https://www.okbtc.cn/bybit?ref=githubio" class="iconfont">
  <img src="/image/logo/bybit.png" width="36px" height="36px" alt="bybit">
</a>

<a href="https://www.okbtc.cn/pionex?ref=githubio" class="iconfont">
  <img src="/image/logo/pionex.png" width="36px" height="36px" alt="pionex">
</a>



</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    2023
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        coin
        
      </span></span>

  
  

  
</div>

      </footer>

      <div class="button__back-to-top">
        <a href="#back-to-top">
          <i class="iconfont">
            
            <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

          </i>
        </a>
      </div>
    </div>
    
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.5e8c82c5ae3f71b40f78c4ff8ea351326a65ddf5771f76c10c6fc7d09808332d.js" integrity="sha256-XoyCxa4/cbQPeMT/jqNRMmpl3fV3H3bBDG/H0JgIMy0=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











<script>
  var remark_config = {
    host: 'https:\/\/remark42.example.com',
    site_id: 'remark',
    components: [
	    'embed',
    ],
  }
  !function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);
</script>







  </body>
</html>
