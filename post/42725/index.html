<!DOCTYPE html>
<html
  lang="zh-cn"
  itemscope
  itemtype="http://schema.org/WebPage"
>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
          跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启 - 区块大全
        </title>
    

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="佚名" /><meta name="description" content="事实证明，编码分支掩码的第一个字节应该始终是 0x00. 修复方法是检查编码的分支掩码的第一个字节是否是 0x00 并且不要将其视为不正确的掩码。" />
<meta name="keywords" content="技术" />







<meta name="generator" content="Hugo 0.120.4" />


<link rel="canonical" href="/post/42725/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.d8d87b982993a745e5e7b6a6cbf257be8c3e82aab5e485f0908ad7e6c3501ab2.css" integrity="sha256-2Nh7mCmTp0Xl57amy/JXvow&#43;gqq15IXwkIrX5sNQGrI=" media="screen" crossorigin="anonymous">







<meta property="og:title" content="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启" />
<meta property="og:description" content="事实证明，编码分支掩码的第一个字节应该始终是 0x00. 修复方法是检查编码的分支掩码的第一个字节是否是 0x00 并且不要将其视为不正确的掩码。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/42725/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-09-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-17T00:00:00+00:00" />

<meta itemprop="name" content="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启">
<meta itemprop="description" content="事实证明，编码分支掩码的第一个字节应该始终是 0x00. 修复方法是检查编码的分支掩码的第一个字节是否是 0x00 并且不要将其视为不正确的掩码。"><meta itemprop="datePublished" content="2022-09-17T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-09-17T00:00:00+00:00" />
<meta itemprop="wordCount" content="6466">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"/>
<meta name="twitter:description" content="事实证明，编码分支掩码的第一个字节应该始终是 0x00. 修复方法是检查编码的分支掩码的第一个字节是否是 0x00 并且不要将其视为不正确的掩码。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




  </head>
  <body>
    <div id="back-to-top"></div>

    <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">区块大全</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="/categories/">分类</a>
          
        
      </li>
    

    
  </ul>
</nav>


    
      






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

    

    

    


    <header id="header" class="header">
      <div class="logo-wrapper">
  <a href="/" class="logo">
    
      区块大全
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="/categories/">分类</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

    </header>

    <div id="mobile-panel">
      <main id="main" class="main bg-llight wallpaper">
        <div class="content-wrapper">
    <div id="content" class="content">
      <article class="post">
        
        <header class="post-header">
          <h1 class="post-title">跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启</h1>
          

          <div class="post-meta">
  <div class="post-meta-author">
    by
      佚名
    
  </div>

  <div class="post-meta-time">
    <time datetime="2022-09-17">
      2022-09-17
    </time>
  </div>

  


  <div class="post-meta__right">
    <span class="post-meta-more">
        约 6466 字 -
        预计阅读 13 分钟
      </span>

    <div class="post-meta-category">
        <a href="/categories/%E5%85%B6%E5%AE%83%E6%96%87%E7%AB%A0/"> 其它文章 </a>
          
      </div>


    
    


    
    
  </div>
</div>

        </header>

        
        <div class="post-content">
          <table>
    <thead>
        <tr>
            <th style="text-align:left">推荐平台</th>
            <th style="text-align:left">链接</th>
            <th style="text-align:left">平台介绍</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">币安网</span></td>
            <td style="text-align:left"><span style="white-space:nowrap"><a
                        href="https://www.okbtc.cn/binance?ref=githubio">注册链接</a></span></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/binance?ref=githubio">币安是全球领先的区块链生态系统，推出了一系列产品，其中包括最大的加密货币交易平台。我们的使命是在未来成为全球性加密货币基础架构供应商。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">欧易OKX</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/okx?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/okx?ref=githubio">欧易是全球著名的数字资产交易平台之一，主要面向全球用户提供比特币、莱特币、以太币等数字资产的币币和衍生品交易服务。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">HTX火币</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/htx?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/htx?ref=githubio">火币全球专业站，是火币集团旗下服务于全球专业交易用户的创新数字资产国际站，致力于发现优质的创新数字资产投资机会。</a>
            </td>
        </tr>
    </tbody>
</table>
<blockquote>
<p>深度解析 Polygon 网络结构、互操作性与跨链消息传递方式，再谈双花漏洞安全事件。</p>
</blockquote>
<p>1 Polygon 是谁？</p>
<p>Polygon 是以太坊的 layer2 扩容方案，其愿景是建造以太坊的区块链互联网。Polygon 提供了一个通用框架，允许开发人员利用以太坊的安全性创建定制的，专注于应用程序的链，并提供一个互操作性网络，结合了各种不同的扩展方案，如：zk-rollup、PoS 等。其中，Polygon PoS 是目前 Polygon 上最成熟和广为人知的扩容方案。它利用侧链进行交易处理，实现提升交易速度并节省 Gas 消耗的目的，网络结构主要包含以下三层：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_kzodsiclv3.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<h3 id="ethereum-层">Ethereum 层：</h3>
<p>以太坊主网上的一系列合约，主要包括：Staking、Checkpoint、Reward 合约，负责 PoS 权益相关的质押管理功能，包括：提供 MATIC 原生代币的质押功能，使得任何质押该代币的人可以作为验证者加入系统；验证 Polygon 网络的转态转换获得质押奖励；惩罚验证者的双重签名、验证者停机等不合法行为；保存 checkpoint。</p>
<h3 id="heimdall-层">Heimdall 层：</h3>
<p>权益证明验证节点层，包括一组 PoS Heimdall 节点，负责将 Polygon 网络的检查点提交给以太坊主网，同时监听部署在以太坊上的一组质押合约。主要流程为：首先选择验证者池中的一部分活跃的验证者作为块生产者，它们将负责在 Bor 层创建区块并广播；接着根据 Bor 提交的检查点，验证 Merkle 根哈希并附加签名；最后，提议者将负责收集指定检查点的所有验证者签名，如果签名数量达到 2/3 以上，则在以太坊上提交该检查点。</p>
<h3 id="bor-层">Bor 层：</h3>
<p>出块节点层，包括一组由 Heimdall 层上的验证者委员会定期选取的区块生产者，它们是一个验证者子集，负责将 Polygon 侧链上的交易聚合并生成区块。该层会定期向 Heimdall 层发布检查点（checkpoint），其中检查点代表 Bor 链上的一个快照，如下图所示。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_c3z4b38l7w.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<h2 id="2polygon-互操作性">2 Polygon 互操作性</h2>
<h3 id="21-检查点checkpoint">2.1 检查点（checkpoint）</h3>
<p>检查点机制是一种将 Bor 层的数据同步到以太坊上的机制，其中同步的数据是检查点，即在一个检查点间隔的时间段内包含的 Bor 层区块数据快照，源码如下：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_90yp1883rq.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<ul>
<li>
<p>Proposer：提议者，它也是由验证者选取的，区块生产者和提议者都是验证者的子集，且他们的责任取决于其在整个池子中的股权比例。</p>
</li>
<li>
<p>RootHash：是由 StartBlock 到 EndBlock 之间的 Bor 块生成的 Merkle Hash。</p>
</li>
</ul>
<p>以下是编号 1 到 n 的 Bor 块生成 RootHash 值的伪码：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_ejzdlqu04r.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>综上，该值是 Bor 区块头中的区块号 number、区块时间戳 time、交易树根 Hash 值 tx hash、收据树根 Hash 值 receipt hash 计算得到的 keccak256 哈希值构成的 Merkel tree 的根哈希值。</p>
<p>AccountRootHash：需要将每个检查点发送到以太坊上的验证者相关账户信息的 Merkle Hash，单个账户信息的哈希值计算方式如下：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_fq8kwn9q0m.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>由账户 Merkle tree 根哈希值生成 AccountRootHash 的方式与 RootHash 值相同。</p>
<h3 id="22-statesync">2.2 StateSync</h3>
<p>状态同步机制（StateSync）是指将以太坊数据同步到 Polygon Matic 链，主要分为以下几个步骤：</p>
<ul>
<li>
<p>首先以太坊上的合约会触发 StateSender.sol 中的 syncState() 函数进行状态同步</p>
</li>
<li>
<p>syncState() 函数将发出一个 event 事件，如下：</p>
</li>
</ul>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_r7q6q09dcd.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<ul>
<li>
<p>Heimdall 层的所有验证者都会收到该事件，其中一个验证者会将该交易打包到 heimdall 区块中，并添加到待处理的状态同步列表中；</p>
</li>
<li>
<p>bor 层节点会通过 API 获取到上述待同步列表，交给 bor 层的合约进行进一步的业务逻辑处理。</p>
</li>
</ul>
<h3 id="23-polygon-bridge">2.3 Polygon Bridge</h3>
<p>Polygon Bridge 实现了 Polygon 和 Ethereum 之间的双向跨链通道，使得用户可以在两个不同链平台之间更为方便地转移代币而不会产生第三方威胁和市场流动性限制。Polygon Bridge 有 PoS 和 Plasma 两种类型，二者在 Polygon 和 Ethereum 之间的资产转移都有以下相同之处：</p>
<p>1）首先需要将 Ethereum 上的代币映射到 Polygon，如下图所示：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_u1lv48ge21.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>2）同样采用双向锚定技术（Two-way Peg），即</p>
<ul>
<li>
<p>a：从以太坊上转移的代币资产都会先在 Ethereum 上被锁定，且相同数量的映射代币会在 Polygon 上被铸造；</p>
</li>
<li>
<p>b：为了将代币资产提取到 Ethereum，首先需要将这些映射代币在 Polygon 上 burn 掉，之后再解锁锁定在 Ethereum 上的资产；</p>
</li>
</ul>
<p>下图为 PoS Bridge 和 Plasma Bridge 的对比：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_afscburkk8.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>由上图可知，安全性方面，PoS Bridge 依赖于外部验证者集合的安全性，而 Plasma 依赖于 Ethereum 主链的安全性。同时在用户进行跨链资产转移时（如将代币从 Polygon 转移到 Ethereum），PoS 仅需要一个检查点的间隔时间，大约 20 分钟到 3 小时；而 Plasma 则需要一个 7 天的争议挑战期。同时 PoS 支持更多的标准代币，而 Plasma 仅支持三种类型，包括：ETH、ERC20、ERC721。</p>
<h2 id="3跨链消息传递pos-bridge">3 跨链消息传递—PoS Bridge</h2>
<p>PoS Bridge 主要包含两个功能：Deposit 和 Withdrawals，其中 Deposit 指的是将用户在以太坊上的资产转移到 Polygon，Withdrawals 则指的是将资产从 Polygon 提取到以太坊上。</p>
<h3 id="deposit">Deposit</h3>
<p>下面以用户 Alice 使用 PoS Bridge 将其以太坊账户上的代币资产发送到其在 Polygon 账户中为例进行介绍：</p>
<p>1、如果用户想转移的代币资产为 ERC20、ERC721、ERC1155 类型，则首先需要用户将要转移的代币通过 approve 函数授权。如下所示：通过调用以太坊上 token 合约中的 approve 方法将对应数量的 token 授权给 erc20Predicate 合约。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_sad653yfst.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>其中 approve 函数有两个参数：</p>
<ul>
<li>
<p>spender：用户授权允许花费代币的目标地址</p>
</li>
<li>
<p>amount：可以被花费的代币数量</p>
</li>
</ul>
<p>2、上述授权交易被确认后，用户接着通过调用 RootChainManager 合约的 depositFor() 方法将代币锁定到以太坊上的 erc20Predicate 合约中。此处，如果转移的资产类型是 ETH，则调用 depositEtherFor()。具体如下：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_ppgvc80qrs.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>其中 depositFor 函数有三个参数：</p>
<ul>
<li>
<p>user：接收 Polygon 上 deposit 代币的用户地址</p>
</li>
<li>
<p>rootToken：以太坊主链上的 token 地址</p>
</li>
<li>
<p>depositData：ABI 编码后的代币数量</p>
</li>
</ul>
<p>以下是 RootChainManager 合约中 depositFor 函数的具体代码：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_y21bsi687a.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_zddgde1s81.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>分析源码可知，该函数首先获取到 token 对应的 predicate 合约地址，接着调用其 lockTokens() 函数将 token 锁定在该合约中。最后_stateSender 将调用 syncState() 进行状态同步，该函数只有 admin 设置的状态发送者（state sender）才能调用。</p>
<p>3、StateSender.sol 中的 syncState() 函数将提交事件 StateSynced，具体为：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_2ffojb5jkb.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>其中第一个参数为该 log 的序号索引，第二个参数用于校验调用者是否是已注册的合法合约地址，第三个是需要进行状态同步的数据。该交易会被添加到 Heimdall 块中，并被添加到挂起的状态同步列表中。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_0er8807c5c.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>4、接着 Polygon Matic 链上的 bor 节点通过 API 获取到状态同步列表中的 StateSynced 事件后，该链上的 ChildChainManager 合约会调用 onStateReceive() 函数，该函数用于接收从以太坊上传过来的同步数据，根据状态同步的业务逻辑类型进行下一步处理：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_2oihe7kf2i.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>data：包括 bytes32 类型的 syncType、bytes 类型的 syncData。其中，syncType 代表业务类型，包括 deposit 和 mapping 代币映射；当 syncType 为 mapping 时，syncData 为编码后的 rootToken 地址、childToken 地址和 bytes32 类型的 tokenType；当 syncType 为 deposit 时，syncData 为编码后的 user 地址、rootToken 地址和 bytes 类型的 depositData。depositData 在 REC20 中是数量，ERC721 中指的是 tokenId。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_kqtn2k066q.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>5、由于此处进行的是 Deposit 业务，所以接着会调用_syncDeposit() 函数。该函数会首先将 syncData 按照对应格式解码，得到对应的 rootToken、user 地址、depositData。接着校验 rootToken 在 polygon 上是否有对应的映射代币 childToken，如果有则调用 childToken 的 deposit() 函数。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_0t62ar4zju.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>6、此处我们以 ERC20 的代币合约为例，介绍映射代币合约如何 deposit。该函数将 mint 对应数量的代币到用户账户中。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_027fhuyhgf.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>该函数有两个参数：</p>
<ul>
<li>
<p>user：正在进行存款的用户地址</p>
</li>
<li>
<p>depositData：用 ABI 编码的 amount</p>
</li>
</ul>
<h3 id="withdrawals">Withdrawals</h3>
<p>下面以用户 Alice 使用 PoS Bridge 将其在 Polygon 账户中存放的资金提取到以太坊账户为例进行介绍：</p>
<p>1、当用户 withdraw 时，需要首先在 Polygon 链上通过调用映射 token 合约的 withdraw() 函数，burn 掉对应数量的映射代币。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_swq9ayckrr.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>withdraw 仅包含一个参数：将要被 burn 掉的 token 数量。对应的 token 合约中的 withdraw() 函数如下：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_wkznbs68hi.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>2、上述交易将经过大约 20 分钟到 3 小时将被包含到 checkpoint 中，被验证者提交到以太坊。</p>
<p>3、一旦交易被添加到检查点中并提交到了以太坊，将调用以太坊上的 RootChainManager 合约的 exit() 函数，该函数将通过验证提交的检查点内容确认在 Polygon 上 withdraw 交易的有效性，并触发对应的 Predicate 合约解锁用户 deposit 的代币。</p>
<p>其中，传入该函数的 Proof 证明 inputData 包括以下数据：</p>
<ul>
<li>
<p>headerNumber：包含了 withdraw 交易的检查点区块 header</p>
</li>
<li>
<p>blockProof：证明子链中的区块头是提交的 merkle root 的叶子节点</p>
</li>
<li>
<p>blockNumber：子链上包含 withdraw 交易的区块号</p>
</li>
<li>
<p>blockTime：withdraw 交易的区块时间戳</p>
</li>
<li>
<p>txRoot：区块交易树的 root 值</p>
</li>
<li>
<p>receiptRoot：区块收据树的 root 值</p>
</li>
<li>
<p>receipt：withdraw 交易的收据</p>
</li>
<li>
<p>receiptProof：withdraw 交易收据的默尔克证明</p>
</li>
<li>
<p>branchMask：收据树中 32 位表示的收据路径</p>
</li>
<li>
<p>receiptLogIndex：从收据树中读取的日志索引</p>
</li>
</ul>
<p>下面是该函数的核心逻辑，主要包括三部分：第一部分是校验 withdraw 交易收据的有效性，第二部分是校验检查点是否包含了交易区块，第三部分是调用 predicate 合约中的 exitTokens() 函数将锁定的代币发送给用户。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_k3m0a9o1o9.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>4、以 ERC20Predicate 合约为例，即从 log 中解码出接收者、发送者、发送代币数量后，将给定数量的代币发送给用户。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_vi1c7yqdku.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>由 PoS Bridge 跨链消息传递过程源码分析可知，整个过程的函数调用都只有验证者指定的角色才能调用，所以跨链的安全性仅由 PoS 保证（公证人）。</p>
<h2 id="4跨链消息传递plasma-bridge">4 跨链消息传递—Plasma Bridge</h2>
<p>Plasma Bridge 同样包含两个功能：Deposit 和 Withdrawals，具体流程如下图所示：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_j3lwn0doe1.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>Polygon Plasma 与我们跨链桥系列第一篇文章介绍的比特币 Plasma MVP 实现略有差别，主要采用基于账户模型的 Plasma MoreVP。该算法与 Plasma 相比，主要在 withdraw 部分做了部分改进。</p>
<p>由于 ERC20、ERC721 的代币传输，是通过类似比特币 UTXO 的 event 日志实现的，所以我们首先介绍一下该事件：</p>
<ul>
<li>
<p>input1：转账前发送者的账户余额</p>
</li>
<li>
<p>input2：转账前接收者的账户余额</p>
</li>
<li>
<p>output1：转账后发送者的账户余额</p>
</li>
<li>
<p>output2：转账后接收者的账户余额</p>
</li>
</ul>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_hvh7d1bp2h.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>其次，原先的 Plasma MVP，由于区块是由单个（Operator）或者少数的区块生产者生成，因此在 Polygon 上存在以下两种攻击场景：</p>
<p><strong>Operator 作恶：</strong></p>
<p>上一篇文章（《<a href="https://foresightnews.pro/article/detail/14068">跨链桥安全回顾：Nomad 去中心化抢劫事件带给我们什么启发？</a>》）提到，当用户的交易被 Operator 打包为 Plasma 区块后，存在链下数据的不可用性问题。因此，用户在进行 exit 交易时，如果从较旧的交易开始退出，Operator 可以使用其最近的一笔交易对其发起挑战，则会挑战成功。同时，由于 Plasma 中采用了 PoS 的检查点机制，Operator 如果勾结验证者作恶，甚至可以伪造一些状态转换并提交到以太坊。</p>
<p><strong>用户作恶：</strong></p>
<p>用户在发起 exit 交易后，继续在 Polygon 上花费代币，类似于跨链的双花。</p>
<p>综上，Polygon 的 Plasma MoreVp 算法采用了另一种计算退出优先级的算法，即从最近的交易开始退出。该方式由于使用了类似 UTXO 的 LogTransfer 事件，只要用户的合法交易使用了正确的 input1、input2，即使 Operator 一些恶意交易打包在用户交易之前，由于用户交易仅来自有效的 input，所以也能被正确处理。相关伪代码如下：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_2vhu5t5hq8.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<h3 id="deposit-1">Deposit</h3>
<p>下面以用户 Alice 使用 Plasma Bridge 将其以太坊账户上的代币资产发送到其在 Polygon 账户中为例进行介绍：</p>
<p>1、首先用户同样需要将其需要转移的代币资产通过 approve 函数授权给主链（Ethereum）上的 Polygon 合约 depositManager。</p>
<p>2、同样等到授权交易被确认后，用户调用 erc20token.deposit() 函数，触发 depositManager 合约的 depositERC20ForUser() 函数，存入用户的 ERC20 代币资产。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_m6vykkslka.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>3、当以太坊主网确认了该 deposit 交易，接下来会创建一个仅包含这笔交易的区块，并将其采用状态同步机制发送到 Polygon 网络上的 childChain 合约中，mint 相同数量的映射币并存入用户在 Polygon 上的账户。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_1jqfy48peh.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p><em>注：由 childChain 合约源码分析可知，Plasma 仅支持三种类型，包括：ETH、ERC20、ERC721。</em></p>
<h3 id="withdraw">Withdraw</h3>
<p>当用户想使用 Plasma bridge 从 Polygon 上提取资产到以太坊上，会经历以下几个步骤：</p>
<p>1、用户通过调用 Polygon 上映射币的 withdraw() 函数，burn 掉 Polygon 链上的映射代币资产：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_5o954qsllu.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>也可以调用 Polygon 上的 Plasma Client 的 withdrawStart() 接口实现。</p>
<p>2、用户可以调用 ERC20Predicate 合约中 startExitWithBurntTokens() 函数，该函数首先会调用 WithdrawManager.verifyInclusion() 校验 checkpoint 是否包含 withdraw 交易和对应的收据，代码如下：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_gj17th7icr.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>验证通过后，将调用 WithdrawManager.addExitToQueue() 将其按照优先级排序插入到消息队列中：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_ou4qv0cnk8.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>最后，addExitToQueue() 调用_addExitToQueue() 铸造一个 NFT 作为退款凭证：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_13hefvaso4.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>3、用户等待 7 天的挑战期</p>
<p>4、挑战期完成，可以调用 WithdrawManager.processExits() 函数将代币发送给用户。</p>
<p>该函数主要分为两个步骤：首先确认消息队列中的 withdraw 交易是否已经过了 7 天挑战期，如果已经超过挑战期则将其该交易移除队列：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_qcwm0qzw2i.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>接着，判断退款凭证 NFT 是否在挑战期内被删除，未被删除则将该 NFT 销毁并将对应资产退还给用户：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_dclf5bsacq.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<h2 id="5polygon-plasma-bridge-双花漏洞">5 Polygon Plasma Bridge 双花漏洞</h2>
<p>2021 年 10 月 5 日，白帽子 Gerhard Wagner 提交了一个 Polygon 漏洞，该漏洞可能导致双花攻击，涉及到的金额为 8.5 亿美元，白帽子因此获得了 Polygon 官方的 2,000,000 美元漏洞赏金。</p>
<p>在前文 Plasma Bridge 的介绍中我们知道，完整的一次 Withdraw 交易过程为：</p>
<ol>
<li>
<p>用户在 Polygon 上发起 Withdraw 交易，该交易会 burn 掉用户在 Polygon 的代币；</p>
</li>
<li>
<p>经过一个检查点间隔（大约 30 分钟），等待该 withdraw 交易被包含到检查点中；</p>
</li>
<li>
<p>超过 2/3 的验证者签名后将其提交到以太坊，此时用户调用 ERC20PredicateBurnOnly 合约中的 startExitWithBurntTokens() 校验 checkpoint 是否包含 burn 交易；</p>
</li>
<li>
<p>校验通过，则铸造一个 NFT 退款凭证发给用户</p>
</li>
<li>
<p>用户等待 7 天挑战期</p>
</li>
<li>
<p>调用 WithdrawManager.processExits() 销毁 NFT，并退款给用户</p>
</li>
</ol>
<p><em>注意：Polygon 为了防止交易重放（双花攻击），使用 NFT 作为退款凭证，来唯一标识一笔 Withdraw 交易。但是，由于 NFT 的 ID 生成缺陷，造成了攻击者可以构造参数利用同一笔有效的 Withdraw 交易，生成多个不同 ID 的 NFT，再利用这些 NFT 进行退款交易，从而实现「双花攻击」。</em></p>
<p>下面将对如何如何生成 NFT 进行详细介绍：</p>
<p>1、由上文中的源码解析可知，addExitToQueue() 会调用_addExitToQueue() 铸造一个 NFT：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_rolog5fo2v.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>由传参分析可知，exitid = priority，则 NFT 的 ID 即为 Plasma Bridge 中的 age 优先级左移一位生成。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_gms5r86srd.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>2、上文的源码解析可知，age 是 WithdrawManager.verifyInclusion() 函数的返回值，该函数会首先校验 withdraw 交易的有效性，校验通过则生成对应的 age。其中，校验的逻辑中使用了可控参数 data 解码出的值 branchMaskBytes：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_bc8j9urwub.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>同时生成 age 时也使用了该值：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_wrr4la5yap.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>3、跟踪交易验证逻辑中的调用的 MerklePatriciaProof.verify() 函数，发现该函数调用_getNibbleArray() 对 branchMaskBytes 进行了转码操作：</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_f0hcomdp6s.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>4、继续跟踪该解码函数，该函数对 branchMaskBytes 转码时存在丢弃部分值的情况，这种数值丢失的方式会造成不同的值转码后获得同样的解码值。具体为：如果传入的 hp 编码后的值 b 的第一个十六进制位（半个字节）是 1 或 3，就解析第二个十六进制位。否则，就直接忽略第一个字节。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_aodmnoloue.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>那么如果攻击者构造一个 branchMaskBytes 参数，使得其第一个十六进制位不等于 1 和 3，则共有 14*16 = 224 种方式，能够获得相同的转码后的值。</p>
<p>具体的攻击流程为：</p>
<ul>
<li>
<p>通过 Polygon Plasma 向 Polygon 存入大量 ETH/ 代币</p>
</li>
<li>
<p>在 Polygon 上发起 Withdraw 交易，等待 7 天的挑战期</p>
</li>
<li>
<p>修改 withdraw 交易中 branchMaskBytes 参数的第一个字节（同一有效交易最多可以重新提交 223 次），重复发起 Withdraw 交易</p>
</li>
</ul>
<p>综上，该漏洞主要是由于生成防止重放的退款凭证 NFT 的 ID 算法设计存在问题，导致相同的退款交易可以生成不同的 NFT，造成双花攻击。事实证明，编码分支掩码的第一个字节应该始终是 0x00. 修复方法是检查编码的分支掩码的第一个字节是否是 0x00 并且不要将其视为不正确的掩码。</p>
<p><img src="https://img.bibiqing.com/news/2022/0917/27_ukg5ki92hp.png" alt="跨链桥警钟常鸣：Polygon 如何预防「潘多拉魔盒」的开启"></p>
<p>原文标题：《跨链桥安全研究 ( 三 ) | 多边形战士 Polygon 安全透析，如何预防「潘多拉魔盒」的开启？》</p>
<p>撰文：成都链安</p>
<p>来源：ForesightNews</p>
<table>
    <thead>
        <tr>
            <th style="text-align:left">推荐平台</th>
            <th style="text-align:left">链接</th>
            <th style="text-align:left">平台介绍</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">Gate芝麻开门</span></td>
            <td style="text-align:left"><span style="white-space:nowrap"><a
                        href="https://www.okbtc.cn/gateio?ref=githubio">平台介绍</a></span></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/gateio?ref=githubio">Gate.io芝麻开门创立于2013年，是全球真实交易量TOP10的加密货币交易平台，向全球数千万用户提供安全可靠、真实透明的数字资产交易服务。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">Bitget</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/bitget?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/bitget?ref=githubio">Bitget的背后是一群区块链技术的早期接受者，也是区块链未来发展的信仰者，一直致力于提供安全、一站式的交易解决方案，帮助用户更聪明地交易。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">Bybit</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/bybit?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/bybit?ref=githubio">Bybit通过数字资产与传统金融的结合，引领数字资产的生态发展。提供一流的流动性，致力于打造业内最安全、公平、高效及人性化的交易服务平台。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">派网</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/pionex?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/pionex?ref=githubio">派网提供多样化的量化交易机器人，用户可依照自身交易需求和策略选择最适合的机器人。 同时派网也提供合约交易与合约网格机器人，给予更方便的合约交易体验。</a>
            </td>
        </tr>
    </tbody>
</table>

        </div>

        
        



        
        


        <footer class="post-footer">
          


          
          <nav class="post-nav">
            
              <a class="prev" href="/post/42720/">
                
                <i class="iconfont">
                  <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

                </i>
                <span class="prev-text nav-default">Vitalik：为什么选择 PoS</span>
                <span class="prev-text nav-mobile">上一篇</span>
              </a>
            
              <a class="next" href="/post/42717/">
                <span class="next-text nav-default">美国金融稳定监管机构将于下周举行会议，讨论数字资产监管相关问题</span>
                <span class="prev-text nav-mobile">下一篇</span>
                
                <i class="iconfont">
                  <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

                </i>
              </a>
          </nav>
        </footer>
      </article>

      
      
        
      


      
      


    </div>

    
    <nav class="toc" id="toc">
    <div class="toc-title">文章目录</div>
    <div class="toc-content custom-scrollbar">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#ethereum-层">Ethereum 层：</a></li>
        <li><a href="#heimdall-层">Heimdall 层：</a></li>
        <li><a href="#bor-层">Bor 层：</a></li>
      </ul>
    </li>
    <li><a href="#2polygon-互操作性">2 Polygon 互操作性</a>
      <ul>
        <li><a href="#21-检查点checkpoint">2.1 检查点（checkpoint）</a></li>
        <li><a href="#22-statesync">2.2 StateSync</a></li>
        <li><a href="#23-polygon-bridge">2.3 Polygon Bridge</a></li>
      </ul>
    </li>
    <li><a href="#3跨链消息传递pos-bridge">3 跨链消息传递—PoS Bridge</a>
      <ul>
        <li><a href="#deposit">Deposit</a></li>
        <li><a href="#withdrawals">Withdrawals</a></li>
      </ul>
    </li>
    <li><a href="#4跨链消息传递plasma-bridge">4 跨链消息传递—Plasma Bridge</a>
      <ul>
        <li><a href="#deposit-1">Deposit</a></li>
        <li><a href="#withdraw">Withdraw</a></li>
      </ul>
    </li>
    <li><a href="#5polygon-plasma-bridge-双花漏洞">5 Polygon Plasma Bridge 双花漏洞</a></li>
  </ul>
</nav>
    </div>
  </nav>


  </div>

      </main>

      <footer id="footer" class="footer">
        <div class="icon-links">
  

<a href="https://www.okbtc.cn/binance?ref=githubio" class="iconfont">
  <img src="/image/logo/binance.png" width="36px" height="36px" alt="binance">
</a>

<a href="https://www.okbtc.cn/okx?ref=githubio" class="iconfont">
  <img src="/image/logo/okx.png" width="36px" height="36px" alt="okx">
</a>

<a href="https://www.okbtc.cn/htx?ref=githubio" class="iconfont">
  <img src="/image/logo/htx.png" width="36px" height="36px" alt="htx">
</a>

<a href="https://www.okbtc.cn/gateio?ref=githubio" class="iconfont">
  <img src="/image/logo/gateio.png" width="36px" height="36px" alt="gateio">
</a>

<a href="https://www.okbtc.cn/bitget?ref=githubio" class="iconfont">
  <img src="/image/logo/bitget.png" width="36px" height="36px" alt="bitget">
</a>

<a href="https://www.okbtc.cn/bybit?ref=githubio" class="iconfont">
  <img src="/image/logo/bybit.png" width="36px" height="36px" alt="bybit">
</a>

<a href="https://www.okbtc.cn/pionex?ref=githubio" class="iconfont">
  <img src="/image/logo/pionex.png" width="36px" height="36px" alt="pionex">
</a>



</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    2023
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        coin
        
      </span></span>

  
  

  
</div>

      </footer>

      <div class="button__back-to-top">
        <a href="#back-to-top">
          <i class="iconfont">
            
            <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

          </i>
        </a>
      </div>
    </div>
    
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.5e8c82c5ae3f71b40f78c4ff8ea351326a65ddf5771f76c10c6fc7d09808332d.js" integrity="sha256-XoyCxa4/cbQPeMT/jqNRMmpl3fV3H3bBDG/H0JgIMy0=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











<script>
  var remark_config = {
    host: 'https:\/\/remark42.example.com',
    site_id: 'remark',
    components: [
	    'embed',
    ],
  }
  !function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);
</script>







  </body>
</html>
