<!DOCTYPE html>
<html
  lang="zh-cn"
  itemscope
  itemtype="http://schema.org/WebPage"
>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
          DeFi新叙事？无Oracle协议的智能合约安全新模式 - 区块大全
        </title>
    

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="佚名" /><meta name="description" content="近期新的 DeFi 创造者们正通过构思全新的借贷和衍生品架构来制造新的叙事，而这些协议的变化相同点是不再去依赖预言机。" />

  <meta name="keywords" content="区块大全, 区块链, 区块链资讯, 区块链快讯, 区块链新闻, 比特币行情" />






<meta name="generator" content="Hugo 0.120.4" />


<link rel="canonical" href="/post/57610/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.d8d87b982993a745e5e7b6a6cbf257be8c3e82aab5e485f0908ad7e6c3501ab2.css" integrity="sha256-2Nh7mCmTp0Xl57amy/JXvow&#43;gqq15IXwkIrX5sNQGrI=" media="screen" crossorigin="anonymous">







<meta property="og:title" content="DeFi新叙事？无Oracle协议的智能合约安全新模式" />
<meta property="og:description" content="近期新的 DeFi 创造者们正通过构思全新的借贷和衍生品架构来制造新的叙事，而这些协议的变化相同点是不再去依赖预言机。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/57610/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-08-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-08-23T00:00:00+00:00" />

<meta itemprop="name" content="DeFi新叙事？无Oracle协议的智能合约安全新模式">
<meta itemprop="description" content="近期新的 DeFi 创造者们正通过构思全新的借贷和衍生品架构来制造新的叙事，而这些协议的变化相同点是不再去依赖预言机。"><meta itemprop="datePublished" content="2023-08-23T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-08-23T00:00:00+00:00" />
<meta itemprop="wordCount" content="6291">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DeFi新叙事？无Oracle协议的智能合约安全新模式"/>
<meta name="twitter:description" content="近期新的 DeFi 创造者们正通过构思全新的借贷和衍生品架构来制造新的叙事，而这些协议的变化相同点是不再去依赖预言机。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




  </head>
  <body>
    <div id="back-to-top"></div>

    <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">区块大全</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="/categories/">分类</a>
          
        
      </li>
    

    
  </ul>
</nav>


    
      






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

    

    

    


    <header id="header" class="header">
      <div class="logo-wrapper">
  <a href="/" class="logo">
    
      区块大全
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="/categories/">分类</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

    </header>

    <div id="mobile-panel">
      <main id="main" class="main bg-llight wallpaper">
        <div class="content-wrapper">
    <div id="content" class="content">
      <article class="post">
        
        <header class="post-header">
          <h1 class="post-title">DeFi新叙事？无Oracle协议的智能合约安全新模式</h1>
          

          <div class="post-meta">
  <div class="post-meta-author">
    by
      佚名
    
  </div>

  <div class="post-meta-time">
    <time datetime="2023-08-23">
      2023-08-23
    </time>
  </div>

  


  <div class="post-meta__right">
    <span class="post-meta-more">
        约 6291 字 -
        预计阅读 13 分钟
      </span>

    <div class="post-meta-category">
        <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"> 区块链 </a>
          
      </div>


    
    


    
    
  </div>
</div>

        </header>

        
        <div class="post-content">
          <table>
    <thead>
        <tr>
            <th style="text-align:left">推荐平台</th>
            <th style="text-align:left">链接</th>
            <th style="text-align:left">平台介绍</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">币安网</span></td>
            <td style="text-align:left"><span style="white-space:nowrap"><a
                        href="https://www.okbtc.cn/binance?ref=githubio">注册链接</a></span></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/binance?ref=githubio">币安是全球领先的区块链生态系统，推出了一系列产品，其中包括最大的加密货币交易平台。我们的使命是在未来成为全球性加密货币基础架构供应商。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">欧易OKX</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/okx?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/okx?ref=githubio">欧易是全球著名的数字资产交易平台之一，主要面向全球用户提供比特币、莱特币、以太币等数字资产的币币和衍生品交易服务。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">HTX火币</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/htx?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/htx?ref=githubio">火币全球专业站，是火币集团旗下服务于全球专业交易用户的创新数字资产国际站，致力于发现优质的创新数字资产投资机会。</a>
            </td>
        </tr>
    </tbody>
</table>
<p>原文作者：YBB Capital Researcher  Ac_Core</p>
<p><img src="https://img.bibiqing.com/news/2023/0823/49th9mnyh6s1mrz" alt="DeFi新叙事？无Oracle协议的智能合约安全新模式"></p>
<h2 id="前言">前言</h2>
<p>Oracle(预言机)是 DeFi 世界中的一个重要因素，虽然不同协议的安全性通常是由底层智能合约网络来继承，但它的正常运行还是需要依赖预言机，如果一个协议的预言机遭受到攻击或者破坏，那么整个协议就会被操控。近期新的 DeFi 创造者们正通过构思全新的借贷和衍生品架构来制造新的叙事，而这些协议的变化相同点是不再去依赖预言机。</p>
<h2 id="defi的风险与修复">DeFi 的风险与修复</h2>
<p>DeFi 的最大魅力来自于：去中心化，它从广义来讲是一种无权限支付协议的开放式金融系统，与传统金融相比，它的规则、利润甚至风险虽都以较为“隐晦”的方式公开，但仍具有非常强的开放度。</p>
<p>但经过几年的发展，DeFi 领域也累计遭到了数十亿美元的盗窃[ 1 ]，即使最为狂热的信徒也会不断质疑它是否能成为未来金融的主流。其中仅在 2022 年黑客通过 DeFi 协议和跨链桥盗取的资金就超过了 38 亿美元，也是加密史中盗窃金额最多的一年。如果想在未来让更庞大的群体进入加密世界并依赖 DeFi，安全性是首要考虑的因素。</p>
<p><img src="https://img.bibiqing.com/news/2023/0823/17_6t9w36tokj.png" alt="DeFi新叙事？无Oracle协议的智能合约安全新模式"></p>
<p>图源：Chainalysis</p>
<h3 id="oracle的风险和源码">Oracle 的风险和“源码”</h3>
<p>Nascent 认为“无 Oracle 协议”的概念将为 DeFi 从根本上提供更加稳健和安全的技术架构。如今 DeFi 更希望将自身定义为“源码（Primitives）”，希望有更多的团队在它们的基础之上构建产品或组合协议。一旦该合约掺杂了任何外部依赖，它们就会继承所有的相关风险，与此同时，该合约为了承载更为庞大的系统生态，会去升级，而这种管理式的升级变量就会涉及到可变更环境的当下及未来，带来更多风险因素。顾名思义 Oracle 的引入产生了外部数据的依赖关系，而这种关系会带来潜在风险。为此 Dan Elitzer 提出了一个全新的定义：为符合源码（Primitives）的条件，除了部署在区块链上的合约之外它不能依赖任何外部因素，比如：没有治理、合约可升级性和预言机。</p>
<p>但现实是如今符合这一基本定义的 DeFi 协议是非常稀有的，其中最有代表性的是 Uniswap V1，但从安全性角度考虑，即使是与上述 Dan Elitzer 提出的定义保持一致的 Uniswap V2与V3也不符合资格，因为它们允许对某些功能进行治理，例如协议费用的闭合与引入池子的费用层级。</p>
<p>话虽如此，这种狭隘的治理功能并没有因其他协议中存在的大规模升级而引发系统性风险，所以迄今为止所有版本中的 Uniswap 取得巨大成功的原因是没有 Oracle 和全链这两个关键因素。</p>
<p>毋庸置疑 Uniswap 是去中心化交易的主导者，它取得了巨大的成功，并在此基础之上诞生出了很多去中心化交易所的实验。好比 Uniswap V3 引入了非同质化流动性头寸的概念，让流动性提供者（LPs）可以将他们的流动性集中在某个特定范围内，这使 LPs 可以捕获在该范围内交易产生的更大份额交易费，并从中获利，但随着价格波动这里也会产生无偿损失。从而导致了资本更高效的使用和市场中 LP 部分的专业化，随即诞生了一系列头寸管理工具，例如 Arrakis、Gamma 和 Sommelier。虽然这对 DEXs 来说非常友好，但借贷协议仍需要预言机。</p>
<p>时间来到今年 3 月，Euler Finance 借贷协议遭受黑客攻击，损失金额高达 2 亿美元。它可以让用户发布抵押品并借款，且有一些独特功能。简而言之它的问题发生在一个特定函数中且没有对它进行安全检查，使用户能破坏借贷市场的基本不变式。此次攻击事件的详细过程请阅读[ 2 ]。</p>
<p>对于借贷协议来说，合格的抵押品仅限于有可靠预言机价格反馈的资产。贷款参数（如贷款价值比 [ 3 ] ）受其协议管理，因此任何坏账都由协议而非单个贷款人负责。同样，依赖于预言机进行定价的衍生品协议如缺乏内部价格发现机制，容易受到价格滞后无更新影响，从而严重限制它们的规模和用户体验。如同前言所述，这也正好解释了为什么交易员 Avraham Eisenberg 能够成功攻击 Mango Markets 并从该加密货币交易平台抽走 1.16 亿美元。</p>
<h3 id="为什么目前uniswap是安全的">为什么目前 Uniswap 是安全的</h3>
<p>AMM 可以具有任何 DeFi 源码（Primitives）中最简单的基本不变式：tokenBalanceX * tokenBalanceY == k（如常数乘积）。例如 Uniswap V2 中 Pair 接口都是基于以下四个函数不变式实现的：</p>
<p>Mint：添加到 k；</p>
<p>Burn：从 k 中减去；</p>
<p>Swap：移动 x 和 y，保持 k 不变；</p>
<p>Skim：重新调整 tokenBalanceX * tokenBalanceY，使其等于 k。</p>
<p>Uniswap V2 的安全之道：一个简单的核心不变式，所有函数都为此服务。唯一值得争议的是它可以切换费用开关的治理模式，但这不会触及核心不变式，只是影响代币余额所有权的分配，也正是由于他们在安全性中的这种简洁性（不可升级的智能合约和基本不变式），Uniswap 本身从未遭受过黑客攻击。</p>
<h2 id="重建贷款协议">重建贷款协议</h2>
<p><img src="https://img.bibiqing.com/news/2023/0823/17_sbckl4rocz.png" alt="DeFi新叙事？无Oracle协议的智能合约安全新模式"></p>
<p>图源：作者 Balakov</p>
<p>近期我们发现对无预言机的借贷协议出现了很多项目，例如 Ajna、Ethereum Credit Guild、MetaStreet 的自动化分层协议（Automated Tranche Maker）以及 Blur 和 Paradig 合作推出的混合协议 Blend [ 4 ]。</p>
<p>与传统的 DeFi 借贷市场不同，Gauntlet 没有设置抵押，也没有像 Chainlink 这样的单通用预言机为所有用户和协议功能提供“真实”资产价格来源。相反借款人需要评估风险，并决定从借款人那里要求一定的抵押品，且必须在资产价格变动时更新他们的借款标准。其工作方式一般来讲是借款人选择他们愿意接受的指定抵押品，例如 BAYC Token 以及个别的 Bored Ape NFT 等，他们愿意提供给借款人用作抵押品的引用资产（如 USDC），以及他们将要求借款人被清算的引用资产与抵押资产的比例。最后借款人可以发布抵押品，并以当前市场利率借入引用资产。</p>
<p>需要注意的是，由于借贷双方已经同意贷款的清算是根据每种资产的单位数量而不是美元价格的比率来确定，因此并不需要预言机。然而，如果任一资产的相对美元价值发生变化，贷款人将调整当下或未来贷款的条款，以达到他们认为安全的抵押比例。</p>
<p>这些方法的最大优势为：协议在实际上是无法破产的。这是因为每个贷款人最终都要对自己贷款的偿付能力负责，因此不存在 &ldquo;坏账 &ldquo;的概念，而这种 &ldquo;坏账 &ldquo;可能要由 DAO 金库/保险基金来承担，或在贷款人之间进行处理。</p>
<p>Blur 的 Blend 混合协议假定 &ldquo;存在能够参与复杂的链上和链下协议、评估风险并使用自有资金的更复杂的贷款人&rdquo;。这在 Blur 作为专业 NFT 交易者的主要交易场所的背景下是有道理的，但对于普通用户来说，这似乎比在 Aave 或 Compound 上借贷要复杂得多。</p>
<h3 id="无oracle的新面孔">无 Oracle 的新面孔</h3>
<p>根据 Messari 研究员 Chase Devens 的定义，无预言机的定义架构可以分为两类，即点对点（Peer-to-Peer）和基于 AMM 的混合类型。其中它们两者的主要特点如下：</p>
<ul>
<li>点对点</li>
</ul>
<p>支持任何的链上抵押品类型</p>
<p>用户承担贷款参数并承担坏账风险（不再是合约承担风险），借款人不再定义利率和 LTV 参数，而是自己决定价值比较，并且从协议的机制中移除预言机意味着这些贷款可以由任何链上抵押品创建。</p>
<p>需要对仓位进行积极管理，为确保提供的流动性得到有效利用，用户必须以类似于 Uniswap V3的集中流动性位置的方式积极管理他们的仓位。</p>
<ul>
<li>基于 AMM 的混合类型（借贷/衍生品—LPs 流动性提供者）</li>
</ul>
<p>支持任何的链上抵押品类型</p>
<p>底层 LP 位置为清算和衍生合约提供定价数据，同时也是清仓主要市场。使协议能够从其底层流动性池中计算清算和衍生合约的结果，从本质上讲，LP 位置自身就像一个预言机。此外，这些 LP 位置在清算或合约到期期间提供了一种主要市场，用于卸载协议库存，而不需要到外部平台清算抵押品。</p>
<p>举例说明：</p>
<p><strong>Ajna.finance</strong></p>
<p>Ajna 是一种专为 EVM 而设计的借贷协议，没有治理、权限或外部价格供给（预言机）。可以用它来借贷我们的整个投资组合（包括 NFT）。其他贷款类项目已达到规模临界值的两个核心问题： ( 1) 代币治理系统不足以分析复杂的风险 ( 2) 使用外部价格反馈（预言机）将资产范围限制为具有流动性二级市场的“蓝筹股”。这些缺陷给 DeFi 借贷市场造成了灾难性损失，并限制了对新资产的支持能力。 Ajna 通过一些关键创新解决了这些问题： </p>
<p>( 1) 贷款方提供资产定价： 当贷款人使用 Ajna 协议时，他们会告诉合约以多少价格抵押资产的意愿。这有效地让他们输入自己的生命周期价值，并将其从治理参数转变为市场参数；</p>
<p>( 2) 自动利率发掘： 在每个 Ajna 市场中，都有一个由内部指标决定的均衡状态。如果市场失衡，任何人都可以每 12 小时改变 10% 的汇率。如果没有，则不做任何改变；</p>
<p>( 3) 清算保证金： 由于 Ajna 没有预言机，它依赖用户告诉它何时清算贷款。这是通过让清算人缴纳保证金以触发清算来实现的。如果他们诚实，他们就会得到回报。如果没有，他们就会受到惩罚。</p>
<p>那么有什么意义呢？ 这些创新使 Ajna 能够为“整个”生态系统提供服务。任何人都可以用任何资产（甚至是 NFT）创建借贷市场。 不再费力地完成的治理流程且不再担心流动性、二级市场和预言机。</p>
<p><strong>Blend</strong></p>
<p><img src="https://img.bibiqing.com/news/2023/0823/17_5amgsdt097.png" alt="DeFi新叙事？无Oracle协议的智能合约安全新模式"></p>
<p>图源：Achal Srinivasan, Kirby</p>
<p>Blend 是一种点对点的永久借贷协议，支持包括 NFT 的任何抵押品。它通过复杂的链下报价协议将有借款意向的用户与愿意提供有竞争优势利率的贷款人进行匹配。</p>
<p>默认情况下，Blend 贷款的利率是固定的，而且永远不会过期。借款人可以随时还款，而贷款人可以通过触发荷兰拍卖，以新的利率寻找新的贷款人，从而退出其头寸。如果拍卖失败，借款人将被清算，贷款人将占有抵押品。整体具有不依赖预言机、无期限、可流动、点对点这四大特性：</p>
<ul>
<li>无预言机</li>
</ul>
<p>很多 DeFi 协议需要预言机来确定清算头寸或确定利率的时机，以 NFT 为例它的价格很难被客观衡量，及时的地板价更新在链上也是非常难被观测，这种解决方案通常需涉及到受信任的一方或交易操纵。而混合协议避免了核心协议中的任何预言机依赖，让利率和贷款比由贷款人意愿条件来决定，最后清算由荷兰拍卖的失败而触发；</p>
<ul>
<li> 无期限</li>
</ul>
<p>一些 DeFi 协议只支持有期限的债务头寸。这对借款人来说很不方便，他们需要在到期前记得关闭或调整头寸（否则可能面临惩罚，如没收 NFT）。手动调整头寸的过程还需要消耗 Gas，这也减少了借贷所产生的收益。只要有贷款人愿意根据抵押品借出这笔金额，Blend 便会自动调整借款头寸，只有在利率变动或其中一方想要退出头寸时才需要进行链上交易；</p>
<ul>
<li>可流动</li>
</ul>
<p>有些协议不支持到期前清算，这样对借款人来说较为方便，并且在很多用例下是合理的。但这实际上是给借款人一个看跌期权，对放款人来说需要在较短的到期时间内从较高的利率/较低的贷款中做出选择，以避免头寸被清算的风险。在 Blend 中，只要贷款人触发再融资拍卖，在没有人愿意以任何利率接手债务的情况下，就可以对 NFT 进行清算；</p>
<ul>
<li>点对点</li>
</ul>
<p>其中一些协议是将贷款人的资金集中在一起，并试图为他们管理资产。这意味着会严重依赖链上管理或集中式管理来设置参数。Blend 采用了点对点的模式，且每笔贷款都是单独匹配，它没有优化贷款方式的简单性而是以假定存在更复杂的借款人能力参与到复杂的链上和链下协议的情况下完成，从而有更大的权限来掌握自己的资产。</p>
<h2 id="什么是frei-pi模式">什么是 FREI-PI 模式</h2>
<p>根据 Nascent 成员 Brock Elmore 解释的 FREI - PI 模式为：“功能需求-影响-交互-协议不变式（Function Requirements-Effects-Interactions + Protocol Invariants pattern）”，这里以 dYdX 的 SoloMargin 合约（源代码）为例，这是一个借贷市场和杠杆交易的合约，即为 FREI-PI 模式的绝佳范例。这是早期借贷市场中唯一没有任何市场相关漏洞的借贷市场。</p>
<p><strong>查看下面代码时注意以下的抽象概念：</strong></p>
<ul>
<li>
<p>输入要求 ( _verifyInputs )</p>
</li>
<li>
<p>操作 ( data transformation, state manipulation )</p>
</li>
<li>
<p>状态要求 ( _verifyFinalState )</p>
</li>
</ul>
<p><img src="https://img.bibiqing.com/news/2023/0823/17_sm09oq54a9.png" alt="DeFi新叙事？无Oracle协议的智能合约安全新模式"></p>
<p>图源：Brock Elmore</p>
<p>这里常用的检查 - 效果 - 交互（Checks-Effects-Interactions） 仍在执行。但需要注意的是，带有附加 Checks 的 Checks-Effects-Interactions 并不等同于 FREI-PI ，虽然它们相似但服务的是不同目标。为此开发人员应该理解它们的不同： FREI-PI 是针对协议安全的高级抽象，而 CEI 则是针对功能安全的高级抽象。</p>
<p>该合约结构有趣的地方是用户可按自己的意愿连续执行多项操作，包括：存款、借贷、交易、转账、清算等。我们假设存入 3 种不同的 Token，且取出第 4 种 Token 并清算账户，这一系列操作只需一键即可完成。</p>
<p>这就是 FREI-PI 的强大之处：只要核心借贷市场不变式在调用结束时成立，用户就可以在协议内做任何想做的事情。对于本合约，这将在 _verifyFinalState 中执行，检查每个受影响账户的抵押情况，确保协议比交易开始时更好。</p>
<p>该函数中还包含一些额外的不变式，它们是核心不变式的补充，有助于实现关闭市场等辅助功能，但真正保证协议安全的是核心检查。</p>
<p>其中以实体为中心的概念是 FREI-PI 的另一个难题，用借贷市场和假定的核心不变式为例：用户不能采取任何行动让任一账户陷入不安全的抵押品状态。从技术角度讲这不是唯一的不变式，但对用户来说是唯一不变量（可理解为仍是核心协议不变式，因为用户不变式就是核心协议不变式）。在借贷市场中通常还会有两个额外的不变式：</p>
<p><strong>1. 预言机</strong></p>
<p>一般来说 Chainlink 是一个不错的选择，它的主要功能是提供准确和相对准确的实时信息，这可以满足大多数不变式的要求。在极少数被操纵或意外情况下，为保证准确性而降低实时性的保障措施可能是有益的（如检查最后已知值是否比当前值大数百个百分点）。不过 Cream Finance 还是出现了 1.3 亿美元的攻击。关于更多预言机的信息请参考：操纵 Uniswap V3 TWAP 预言机[ 5 ]；</p>
<p><strong>2. 治理</strong></p>
<p>治理是最棘手的不变式，因为它难以受到条件约束且大部分作用是改变其他的不变式，且某些治理在操作时无法通过 FREI-PI 进行验证。以 Compound 在 2022 年 8 月发生的破坏 cETH 市场的治理操作为例，此次升级违反了预言机的不变式，内容详情阅读[ 6 ]。</p>
<p>在实际中，每个额外的不变式都使得协议变得更加难以保护，所以应当越少越好。因此复杂是危险的，而最重要的不变式就是协议核心的不变式，但如上文所述也会存在一些以实体为中心的不变式，这些不变式必须满足核心不变式的要求，最简单/最小的不变式集合可能是安全的。</p>
<h2 id="小结defi的未来">小结：DeFi 的未来</h2>
<p>将 DeFi 建立在不可升级的源码（Primitives）之上且脱离预言机是最优的解决方案吗？毕竟目前 DeFi 协议依靠治理、可升级性和预言机而带来的灵活性和易用性也让整个市场规模达到了数千亿美元。据 Nascent 成员 Dan Elitzer 的观点：治理、可升级与预言机它们在本质上也并非是不好的，相反这些元素在更广义的环境下都具有非常大的实际价值，但这也会增加协议的攻击概率。</p>
<p>在根据需求更新功能或改进效率的前提下，源码（Primitives）本身也是可以被偶尔替换的。在选择如何创建 DeFi 协议时将会面临着两个重要的选择：将所有用户的数据和外部条件的依赖交给较为中心化的单一协议，并委托给一小部分愿意参与治理的 Token 持有者？还是重视市场中每个参与者的所有权，让用户自己决定协议和服务商？</p>
<p>整个行业的参与者和开发者都致力于建设更为去中心化、无许可、高组合性的 DeFi，以此提升整个行业的安全性和弹性。关于 DeFi 未来的发展方向，我们希望它能以更为安全和高效的运行方式不断占领传统金融的市场份额。</p>
<p>解释及参考文献：</p>
<p>[ 1 ] <a href="https://rekt.news/leaderboard/">https://rekt.news/leaderboard/</a></p>
<p>[2] <a href="mailto:https://medium.com/@omniscia.io/euler-finance-incident-post-mortem-1ce077c28454">https://medium.com/@omniscia.io/euler-finance-incident-post-mortem-1ce077c28454</a></p>
<p>[3] <a href="https://www.investopedia.com/terms/l/loantovalue.asp">https://www.investopedia.com/terms/l/loantovalue.asp</a></p>
<p>[4] <a href="https://www.paradigm.xyz/2023/05/blend">https://www.paradigm.xyz/2023/05/blend</a></p>
<p>[5] <a href="https://github.com/euler-xyz/uni-v3-twap-manipulation/blob/master/cost-of-attack.pdf">https://github.com/euler-xyz/uni-v3-twap-manipulation/blob/master/cost-of-attack.pdf</a></p>
<p>[ 6 ] <a href="https://medium.com/chainlight/the-suspension-of-compound-finances-ceth-market-causes-and-solutions-b106c2e1c922">https://medium.com/chainlight/the-suspension-of-compound-finances-ceth-market-causes-and-solutions-b106c2e1c922</a></p>
<p><a href="https://www.nascent.xyz/idea/youre-writing-require-statements-wrong">https://www.nascent.xyz/idea/youre-writing-require-statements-wrong</a></p>
<p><a href="https://www.nascent.xyz/idea/why-defi-is-broken-and-how-to-fix-it-pt-1-oracle-free-protocols">https://www.nascent.xyz/idea/why-defi-is-broken-and-how-to-fix-it-pt-1-oracle-free-protocols</a></p>
<table>
    <thead>
        <tr>
            <th style="text-align:left">推荐平台</th>
            <th style="text-align:left">链接</th>
            <th style="text-align:left">平台介绍</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">Gate芝麻开门</span></td>
            <td style="text-align:left"><span style="white-space:nowrap"><a
                        href="https://www.okbtc.cn/gateio?ref=githubio">平台介绍</a></span></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/gateio?ref=githubio">Gate.io芝麻开门创立于2013年，是全球真实交易量TOP10的加密货币交易平台，向全球数千万用户提供安全可靠、真实透明的数字资产交易服务。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">Bitget</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/bitget?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/bitget?ref=githubio">Bitget的背后是一群区块链技术的早期接受者，也是区块链未来发展的信仰者，一直致力于提供安全、一站式的交易解决方案，帮助用户更聪明地交易。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">Bybit</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/bybit?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/bybit?ref=githubio">Bybit通过数字资产与传统金融的结合，引领数字资产的生态发展。提供一流的流动性，致力于打造业内最安全、公平、高效及人性化的交易服务平台。</a>
            </td>
        </tr>
        <tr>
            <td style="text-align:left"><span style="white-space:nowrap">派网</span></td>
            <td style="text-align:left"><a href="https://www.okbtc.cn/pionex?ref=githubio">注册链接</a></td>
            <td style="text-align:left"><a
                    href="https://www.okbtc.cn/pionex?ref=githubio">派网提供多样化的量化交易机器人，用户可依照自身交易需求和策略选择最适合的机器人。 同时派网也提供合约交易与合约网格机器人，给予更方便的合约交易体验。</a>
            </td>
        </tr>
    </tbody>
</table>

        </div>

        
        



        
        


        <footer class="post-footer">
          


          
          <nav class="post-nav">
            
              <a class="prev" href="/post/57551/">
                
                <i class="iconfont">
                  <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

                </i>
                <span class="prev-text nav-default">Curve创始人：相信CRV OTC买家会遵守锁仓半年承诺，违反者无负面影响</span>
                <span class="prev-text nav-mobile">上一篇</span>
              </a>
            
              <a class="next" href="/post/57569/">
                <span class="next-text nav-default">Excel变天！微软把Python「塞」进去了，直接可搞机器学习</span>
                <span class="prev-text nav-mobile">下一篇</span>
                
                <i class="iconfont">
                  <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

                </i>
              </a>
          </nav>
        </footer>
      </article>

      
      
        
      


      
      


    </div>

    
    <nav class="toc" id="toc">
    <div class="toc-title">文章目录</div>
    <div class="toc-content custom-scrollbar">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#defi的风险与修复">DeFi 的风险与修复</a>
      <ul>
        <li><a href="#oracle的风险和源码">Oracle 的风险和“源码”</a></li>
        <li><a href="#为什么目前uniswap是安全的">为什么目前 Uniswap 是安全的</a></li>
      </ul>
    </li>
    <li><a href="#重建贷款协议">重建贷款协议</a>
      <ul>
        <li><a href="#无oracle的新面孔">无 Oracle 的新面孔</a></li>
      </ul>
    </li>
    <li><a href="#什么是frei-pi模式">什么是 FREI-PI 模式</a></li>
    <li><a href="#小结defi的未来">小结：DeFi 的未来</a></li>
  </ul>
</nav>
    </div>
  </nav>


  </div>

      </main>

      <footer id="footer" class="footer">
        <div class="icon-links">
  

<a href="https://www.okbtc.cn/binance?ref=githubio" class="iconfont">
  <img src="/image/logo/binance.png" width="36px" height="36px" alt="binance">
</a>

<a href="https://www.okbtc.cn/okx?ref=githubio" class="iconfont">
  <img src="/image/logo/okx.png" width="36px" height="36px" alt="okx">
</a>

<a href="https://www.okbtc.cn/htx?ref=githubio" class="iconfont">
  <img src="/image/logo/htx.png" width="36px" height="36px" alt="htx">
</a>

<a href="https://www.okbtc.cn/gateio?ref=githubio" class="iconfont">
  <img src="/image/logo/gateio.png" width="36px" height="36px" alt="gateio">
</a>

<a href="https://www.okbtc.cn/bitget?ref=githubio" class="iconfont">
  <img src="/image/logo/bitget.png" width="36px" height="36px" alt="bitget">
</a>

<a href="https://www.okbtc.cn/bybit?ref=githubio" class="iconfont">
  <img src="/image/logo/bybit.png" width="36px" height="36px" alt="bybit">
</a>

<a href="https://www.okbtc.cn/pionex?ref=githubio" class="iconfont">
  <img src="/image/logo/pionex.png" width="36px" height="36px" alt="pionex">
</a>



</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    2023
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        coin
        
      </span></span>

  
  

  
</div>

      </footer>

      <div class="button__back-to-top">
        <a href="#back-to-top">
          <i class="iconfont">
            
            <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

          </i>
        </a>
      </div>
    </div>
    
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.5e8c82c5ae3f71b40f78c4ff8ea351326a65ddf5771f76c10c6fc7d09808332d.js" integrity="sha256-XoyCxa4/cbQPeMT/jqNRMmpl3fV3H3bBDG/H0JgIMy0=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











<script>
  var remark_config = {
    host: 'https:\/\/remark42.example.com',
    site_id: 'remark',
    components: [
	    'embed',
    ],
  }
  !function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);
</script>







  </body>
</html>
